sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/m/MessageToast","sap/ui/core/message/MessageManager","sap/ui/core/message/Message","sap/ui/core/MessageType","sap/m/Token","sap/m/MessageBox","sap/ui/co+
re/UIComponent","sap/ui/core/routing/Route"],function(e,t,i,r,s,a,n,o,l,c,g){"use strict";return e.extend("com.rds.rap.yrdsrap0020.controller.Detail",{onInit:function(){var e={IsRowSelected:false,bBusy:false,oItems:[],sState:"Success",status:"",statusDes+
:""};var i=new t(e);this.getView().setModel(i,"selected");var r=c.getRouterFor(this);r.attachRouteMatched(function(e){var t,i,r;t=e.getParameter("name");if(t==="Detail"){this._onRouteMatched(e)}},this);this.repriceMessageManager=new s;this.getView().setM+
odel(this.repriceMessageManager.getMessageModel(),"repriceMessage");this.repriceMessageManager.registerObject(this.getView(),true);this.rejectMessageManager=new s;this.getView().setModel(this.rejectMessageManager.getMessageModel(),"rejectMessage");this.r+
ejectMessageManager.registerObject(this.getView(),true)},_onRouteMatched:function(e){var t,i;t=e.getParameter("arguments");i=this.getView();i.bindElement({path:"/stock('"+t.SalesOrder+"')",events:{dataRequested:function(e){i.setBusy(true)},dataReceived:f+
unction(e){i.setBusy(false)}}})},onPressRejectAll:function(e){var t=this.getView();var r=this;if(!this.getView().byId("dialogRejectAll")){i.load({id:t.getId(),name:"com.rds.rap.yrdsrap0020.view.popup.RejectAll",controller:r}).then(function(e){t.addDepend+
ent(e);e.open()}.bind(this))}else{this.getView().byId("dialogRejectAll").open()}},onRejectAll:function(e){var t=this.getView();var i=this.getView().byId("InputReject").getValue();var r=this.getView().getModel();var s=this.getView().getModel("rejectMessag+
e");var a=[{SalesOrder:t.getBindingContext().getProperty("SalesOrder"),rejectReason:i}];var n=_.map(a,_.property("SalesOrder"));var o=[];if(i!==""){r.setDeferredGroups(r.getDeferredGroups().concat(["rejectFunction"]));a.forEach(function(e,t){r.callFuncti+
on("/RejectAll",{method:"POST",urlParameters:e,groupId:"rejectFunction",changeSetId:t})},this);r.submitChanges({groupId:"rejectFunction",success:function(e){this.getView().byId("dialogRejectAll").close();r.refresh();o=this.resultMessageForm(e,n,s);this.o+
penRejectResultDialog(o,t)}.bind(this),error:function(e){this.getView().byId("dialogRejectAll").close();o=this.resultMessageForm(e,n,s);this.openRejectResultDialog(o,t)}.bind(this)})}else{o=this.rejectReasonEmptyMessage(n);this.openRejectResultDialog(o,t+
)}},onRejectReasonVH:function(){var e=this.getView();var r=this;var s=new t({cols:[{label:e.getModel("i18n").getProperty("fdRejectAllReason"),template:"Status",width:"6rem"},{label:e.getModel("i18n").getProperty("fdDescription"),template:"StatusDesc",wid+
th:"20rem"}]});if(!this.getView().byId("vhDialogRejectReason")){i.load({id:e.getId(),name:"com.rds.rap.yrdsrap0020.view.VH.RejectReasonVH",controller:r}).then(function(t){e.addDependent(t);this.initMIReject();t.setKey("Status");t.getTableAsync().then(fun+
ction(i){i.setModel(e.getModel());i.setModel(s,"columns");i.setVisibleRowCount(7);i.getColumns().forEach(function(e,t){e.setProperty("sortProperty",s.oData.cols[t].template)});if(i.bindRows){i.bindAggregation("rows",{path:"/Z_VH_REJECTREASON",events:{dat+
aReceived:function(){t.update()}}})}if(i.bindItems){i.bindAggregation("items","/Z_VH_REJECTREASON",function(){return new ColumnListItem({cells:aCols.map(function(e){return new Label({text:"{"+e.template+"}"})})})})}});t.setTokens([]);t.update();t.open()}+
.bind(this))}else{this.getView().byId("vhDialogRejectReason").open()}},onSelectionChangeRejRsnVH:function(e){console.log(this);console.log(e);var t=e.getParameter("tokens");this.getView().byId("InputReject").setValue(t[0].getKey());this.getView().byId("v+
hDialogRejectReason").close()},onReasonVH:function(e){var t=this.getView();var r=this;i.load({id:t.getId(),name:"com.rds.rap.yrdsrap0020.view.VH.ReasonVH",controller:r}).then(function(e){t.addDependent(e);e.setRangeKeyFields([{label:this.getView().getMod+
el("i18n").getProperty("fdRejectAllReason"),key:"Status",type:"string"}]);e.open()}.bind(this))},onReasonVHOk:function(e){var t=e.getParameter("tokens");var i=this.byId("MIVHRejRsn");i.removeAllTokens();while(t.length>1){t=[t.pop()]}i.setTokens(t);this.b+
yId("dialogReason").close()},onReasonVHCanc:function(){this.byId("dialogReason").close()},onReasonVHClose:function(){this.byId("dialogReason").destroy()},onDescriptionVH:function(e){var t=this.getView();var r=this;i.load({id:t.getId(),name:"com.rds.rap.y+
rdsrap0020.view.VH.DescriptionVH",controller:r}).then(function(e){t.addDependent(e);e.setRangeKeyFields([{label:this.getView().getModel("i18n").getProperty("fdDescription"),key:"StatusDesc",type:"string"}]);e.open()}.bind(this))},onDescriptionVHOK:functi+
on(e){var t=e.getParameter("tokens");var i=this.byId("MIVHRejRsnDes");i.removeAllTokens();while(t.length>1){t=[t.pop()]}i.setTokens(t);this.byId("dialogDescription").close()},onDescriptionVHCanc:function(){this.byId("dialogDescription").close()},onDescri+
ptionVHClose:function(){this.byId("dialogDescription").destroy()},openRejectResultDialog:function(e,t){this.rejectMessageManager.removeAllMessages();this.rejectMessageManager.addMessages(e);var r=n.Success;if(_.find(e,{type:n.Warning})){r=n.Warning}if(_.+
find(e,{type:n.Error})){r=n.Error}this.getView().getModel("selected").setProperty("/sState",r);if(!this.getView().byId("dialogRejectResult")){i.load({id:t.getId(),name:"com.rds.rap.yrdsrap0020.view.popup.RejectResult",controller:this}).then(function(e){t+
.addDependent(e);e.open()}.bind(this))}else{this.getView().byId("dialogRejectResult").open()}},rejectReasonEmptyMessage:function(e){var t=[];e.forEach(function(e){t=_.concat(t,[new a({message:this.getView().getModel("i18n").getProperty("erEmptyReason"),t+
ype:n.Error,description:e})])},this);return t},onPressReprice:function(e){var t=this.getView();var r=this;if(!this.getView().byId("dialogReprice")){i.load({id:t.getId(),name:"com.rds.rap.yrdsrap0020.view.popup.Reprice",controller:r}).then(function(e){t.a+
ddDependent(e);e.open()}.bind(this))}else{this.getView().byId("dialogReprice").open()}},onReprice:function(e){var t=this.getView();t.getModel("selected").setProperty("/bBusy",true);var i=this.getView().byId("repriceDP").getValue();var r=this.getView().ge+
tModel();var s=this.getView().getModel("repriceMessage");var a=[{SalesOrder:t.getBindingContext().getProperty("SalesOrder"),RepriceDate:i}];var n=_.map(a,_.property("SalesOrder"));var o=[];if(i!==""){r.setDeferredGroups(r.getDeferredGroups().concat(["rep+
riceFunction"]));a.forEach(function(e,t){r.callFunction("/Reprice",{method:"POST",urlParameters:e,groupId:"repriceFunction",changeSetId:t})},this);r.submitChanges({groupId:"repriceFunction",success:function(e){this.getView().byId("dialogReprice").close()+
;r.refresh();o=this.resultMessageForm(e,n,s);this.openRepriceResultDialog(o,t)}.bind(this),error:function(e){this.getView().byId("dialogReprice").close();o=this.resultMessageForm(e,n,s);this.openRepriceResultDialog(o,t)}.bind(this)})}else{o=this.orderDat+
eEmptyMessage(n);this.openRepriceResultDialog(o,t)}this.getView().getModel("selected").setProperty("/bBusy",false)},openRepriceResultDialog:function(e,t){this.repriceMessageManager.removeAllMessages();this.repriceMessageManager.addMessages(e);var r=n.Suc+
cess;if(_.find(e,{type:n.Warning})){r=n.Warning}if(_.find(e,{type:n.Error})){r=n.Error}this.getView().getModel("selected").setProperty("/sState",r);if(!this.getView().byId("dialogRepriceResult")){i.load({id:t.getId(),name:"com.rds.rap.yrdsrap0020.view.po+
pup.RepriceResult",controller:this}).then(function(e){t.addDependent(e);e.open()}.bind(this))}else{this.getView().byId("dialogRepriceResult").open()}},orderDateEmptyMessage:function(e){var t=[];e.forEach(function(e){t=_.concat(t,[new a({message:this.getV+
iew().getModel("i18n").getProperty("erEmptyDate"),type:n.Error,description:e})])},this);return t},onCloseRep:function(){this.getView().byId("repriceDP").setValue(null);this.getView().byId("dialogReprice").close()},onCloseRej:function(){this.getView().byI+
d("dialogRejectAll").close()},onCloseRepRes:function(){this.getView().byId("dialogRepriceResult").close()},onCloseRejRes:function(){this.getView().byId("dialogRejectResult").close()},onVHCancRejRsn:function(){this.getView().byId("vhDialogRejectReason").c+
lose()},pressLinkExternal:function(e){var t=e.getSource().getBindingContext().getObject();var i=this.getCustomData(e.getSource(),"Semantic");var r=this.getCustomData(e.getSource(),"Action");var s={semanticObject:i,action:r};var a=this._getExternalParamet+
er(s,t);this.onListNavigationExtension(s,a);return true},onListNavigationExtension:function(e,t){sap.ushell.Container.getService("CrossApplicationNavigation").toExternal({target:{semanticObject:e.semanticObject,action:e.action},params:t})},getCustomData:+
function(e,t){var i=e?e.getCustomData():[];var r=_.find(i,function(e){return e.getProperty("key")===t});return r&&r.getProperty("value")},_getExternalParameter:function(e,t){var i={};if(e.semanticObject==="SalesOrder"){i={SalesOrder:t.SalesOrder}}else if+
(e.semanticObject==="SPOC09"){if(e.action==="F0850A"){i={SoldToParty:t.SoldToParty}}else if(e.action==="F4596"){i={SoldToParty:t.SoldToParty}}}return i},resultMessageForm:function(e,t,i){var r=[];var s=this;var n=e.__batchResponses;n.forEach(function(e,s+
){var n=JSON.parse(e.__changeResponses[0].headers["sap-message"]);if(n.details.length>0){n=n.details[0]}var o=this.checkMessageType(n.severity);r=_.concat(r,[n].map(function(e){return new a({message:e.message,type:o,description:t[s],processor:i})}))},thi+
s);return r},checkMessageType:function(e){var t=_.capitalize(e);var i=n.None;if(t==="Success"){i=n.Success}else if(t==="Error"){i=n.Error}else if(t==="Warning"){i=n.Warning}return i},initMIReject:function(){var e=this.byId("MIVHRejRsn");var t=this.byId("+
MIVHRejRsnDes");var i=function(e){var t=e.text;return new o({key:"="+t,text:"="+t})};e.addValidator(i);t.addValidator(i)},valuHelpCustomFilter_rejectAll:function(e){var t=this.getView().byId("fbRejectReason");var i=this._valueHelpSupportRangeFilter(t);th+
is._filterValueHelpTable_rejectAll(i)},_filterValueHelpTable_rejectAll:function(e){this.byId("vhDialogRejectReason").getTableAsync().then(function(t){if(t.bindRows){t.getBinding("rows").filter(e)}if(t.bindItems){t.getBinding("items").filter(e)}this.byId(+
"vhDialogRejectReason").update()}.bind(this))},_valueHelpSupportRangeFilter:function(e){var t=e.getBasicSearchValue();var i=[];var r=[];e.getAllFilterItems().forEach(function(e){var s=e.getControl();switch(s.getMetadata().getName()){case"sap.m.Input":if(+
s.getValue()){r.push(new Filter({path:s.getName(),operator:FilterOperator.Contains,value1:s.getValue().replace(/(^[0]*)/gi,"")}))}if(t){i.push(new Filter({path:s.getName(),operator:FilterOperator.Contains,value1:t}))}break;case"sap.m.MultiInput":var a=/\+
*([- ,가-힣`~!@#$%^&*|\\\'\";:\/?0-9a-zA-Z]+)\*/;var n=/<=([- ,가-힣`~!@#$%^&*|\\\'\";:\/?0-9a-zA-Z]+)/;var o=/>=([- ,가-힣`~!@#$%^&*|\\\'\";:\/?0-9a-zA-Z]+)/;var l=/!\(=([- ,가-힣`~!@#$%^&*|\\\'\";:\/?0-9a-zA-Z]*)\)/;var c=/=([- ,가-힣`~!@#$%^&*|\\\'\";:\/?0-9a-z+
A-Z]*)/;var g=/([- ,가-힣`~!@#$%^&*|\\\'\";:\/?0-9a-zA-Z]+)\*/;var d=/\*([- ,가-힣`~!@#$%^&*|\\\'\";:\/?0-9a-zA-Z]+)/;var p=/([- ,가-힣`~!@#$%^&*|\\\'\";:\/?0-9a-zA-Z]+)\.\.\.([- ,가-힣`~!@#$%^&*|\\\'\";:\/?0-9a-zA-Z]+)/;var u=/<([- ,가-힣`~!@#$%^&*|\\\'\";:\/?0-9+
a-zA-Z]+)/;var h=/>([- ,가-힣`~!@#$%^&*|\\\'\";:\/?0-9a-zA-Z]+)/;_.forEach(s.getTokens(),function(e){var t=e.getText();var i="";var f="";var R="";if(t==="<empty>"){i=FilterOperator.EQ;f=""}else if(t==="!(<empty>)"){i=FilterOperator.NE;f=""}else if(t.match(+
a)){i=FilterOperator.Contains;f=t.match(a)[1]}else if(t.match(n)){i=FilterOperator.LE;f=t.match(n)[1]}else if(t.match(o)){i=FilterOperator.GE;f=t.match(o)[1]}else if(t.match(l)){i=FilterOperator.NE;f=t.match(l)[1]}else if(t.match(c)){i=FilterOperator.EQ;+
f=t.match(c)[1]}else if(t.match(g)){i=FilterOperator.StartsWith;f=t.match(g)[1]}else if(t.match(d)){i=FilterOperator.EndsWith;f=t.match(d)[1]}else if(t.match(p)){i=FilterOperator.BT;f=t.match(p)[1];R=t.match(p)[2]}else if(t.match(u)){i=FilterOperator.LT;+
f=t.match(u)[1]}else if(t.match(h)){i=FilterOperator.GT;f=t.match(h)[1]}else{i=FilterOperator.Contains;f=t}var m=new Filter({path:s.getName(),operator:i,value1:f,value2:R});r.push(m)});if(t){i.push(new Filter({path:s.getName(),operator:FilterOperator.Con+
tains,value1:t}))}break;case"sap.m.MultiComboBox":var f=s.getSelectedKeys();var R=[];if(f.length>0){_.forEach(f,function(e){R.push(new Filter({path:s.getName(),operator:FilterOperator.EQ,value1:e}))});r.push(new Filter({filters:R,bAnd:false}))}break}}.bi+
nd(this),[]);var s=[];if(i.length>0&&r.length>0){s=new Filter({filters:[new Filter({filters:i,bAnd:false}),new Filter({filters:r,bAnd:true})],bAnd:true})}else if(i.length>0){s=new Filter({filters:i,bAnd:false})}else if(r.length>0){s=new Filter({filters:r+
,bAnd:true})}else{s=null}return s},checkEmptyFormat:function(e){if(e){return e}else{return"-"}}})});                                                                                                                                                           