sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/m/MessageToast","sap/ui/core/message/MessageManager","sap/ui/core/message/Message","sap/ui/core/MessageType","sap/m/Token","sap/m/MessageBox","sap/ui/co+
mp/valuehelpdialog/ValueHelpRangeOperation","sap/ui/model/FilterOperator","sap/ui/model/Filter","sap/m/ColumnListItem"],function(e,t,s,i,a,r,n,o,l,c,g,d,p){"use strict";return e.extend("com.rds.rap.yrdsrap0020.controller.Main",{onInit:function(){var e={I+
sRowSelected:false,bBusy:false,oItems:[],sState:"Success",status:"",statusDes:""};var s=new t(e);this.getView().setModel(s,"selected");this.repriceMessageManager=new a;this.getView().setModel(this.repriceMessageManager.getMessageModel(),"repriceMessage")+
;this.repriceMessageManager.registerObject(this.getView(),true);this.rejectMessageManager=new a;this.getView().setModel(this.rejectMessageManager.getMessageModel(),"rejectMessage");this.rejectMessageManager.registerObject(this.getView(),true)},onPressRej+
ectAll:function(e){var t=this.getView();var i=this;if(!this.getView().byId("dialogRejectAll")){s.load({id:t.getId(),name:"com.rds.rap.yrdsrap0020.view.popup.RejectAll",controller:i}).then(function(e){t.addDependent(e);e.open()}.bind(this))}else{this.getV+
iew().byId("dialogRejectAll").open()}},onPressReprice:function(e){var t=this.getView();var i=this;if(!this.getView().byId("dialogReprice")){s.load({id:t.getId(),name:"com.rds.rap.yrdsrap0020.view.popup.Reprice",controller:i}).then(function(e){t.addDepend+
ent(e);e.open()}.bind(this))}else{this.getView().byId("dialogReprice").open()}},onSelectionChangeMain:function(){var e=this.byId("tbMain");var t=this.getView().getModel("selected");if(e.getSelectedItems().length){t.setProperty("/IsRowSelected",true)}else+
{t.setProperty("/IsRowSelected",false)}},onRejectAll:function(){var e=this.getView();e.getModel("selected").setProperty("/bBusy",true);var t=this.getView().byId("InputReject").getValue();var s=this.getView().getModel();var i=this.getView().getModel("reje+
ctMessage");var a=this.byId("tbMain").getSelectedItems().map(function(e){return{SalesOrder:e.getBindingContext().getProperty("SalesOrder"),rejectReason:t}});var r=_.map(a,_.property("SalesOrder"));var n=[];if(t!==""){s.setDeferredGroups(s.getDeferredGrou+
ps().concat(["rejectFunction"]));a.forEach(function(e,t){s.callFunction("/RejectAll",{method:"POST",urlParameters:e,groupId:"rejectFunction",changeSetId:t})},this);s.submitChanges({groupId:"rejectFunction",success:function(t){this.getView().byId("dialogR+
ejectAll").close();s.refresh();n=this.resultMessageForm(t,r,i);this.openRejectResultDialog(n,e)}.bind(this),error:function(t){this.getView().byId("dialogRejectAll").close();n=this.resultMessageForm(t,r,i);this.openRejectResultDialog(n,e)}.bind(this)})}el+
se{n=this.rejectReasonEmptyMessage(r);this.openRejectResultDialog(n,e)}this.getView().getModel("selected").setProperty("/bBusy",false)},onRejectReasonVH:function(){var e=this.getView();var i=this;var a=e.getModel("selected");var r=new t({cols:[{label:e.g+
etModel("i18n").getProperty("fdRejectAllReason"),template:"Status",width:"6rem"},{label:e.getModel("i18n").getProperty("fdDescription"),template:"StatusDesc",width:"20rem"}]});if(!this.getView().byId("vhDialogRejectReason")){s.load({id:e.getId(),name:"co+
m.rds.rap.yrdsrap0020.view.VH.RejectReasonVH",controller:i}).then(function(t){e.addDependent(t);this.initMIReject();t.setKey("Status");t.getTableAsync().then(function(s){s.setModel(e.getModel());s.setModel(r,"columns");s.setVisibleRowCount(7);s.getColumn+
s().forEach(function(e,t){e.setProperty("sortProperty",r.oData.cols[t].template)});if(s.bindRows){s.bindAggregation("rows",{path:"/Z_VH_REJECTREASON",events:{dataReceived:function(){t.update()}}})}if(s.bindItems){s.bindAggregation("items","/Z_VH_REJECTRE+
ASON",function(){return new p({cells:aCols.map(function(e){return new Label({text:"{"+e.template+"}"})})})})}});t.setTokens([]);t.update();t.open()}.bind(this))}else{this.getView().byId("vhDialogRejectReason").open()}},onSelectionChangeRejRsnVH:function(+
e){console.log(this);console.log(e);var t=e.getParameter("tokens");this.getView().byId("InputReject").setValue(t[0].getKey());this.getView().byId("vhDialogRejectReason").close()},onReasonVH:function(e){var t=this.getView();var i=this;s.load({id:t.getId()+
,name:"com.rds.rap.yrdsrap0020.view.VH.ReasonVH",controller:i}).then(function(e){t.addDependent(e);e.setRangeKeyFields([{label:this.getView().getModel("i18n").getProperty("fdRejectAllReason"),key:"Status",type:"string"}]);e.open()}.bind(this))},onReasonV+
HOk:function(e){var t=e.getParameter("tokens");var s=this.byId("MIVHRejRsn");s.removeAllTokens();while(t.length>1){t=[t.pop()]}s.setTokens(t);this.byId("dialogReason").close()},onReasonVHCanc:function(){this.byId("dialogReason").close()},onReasonVHClose:+
function(){this.byId("dialogReason").destroy()},onDescriptionVH:function(e){var t=this.getView();var i=this;s.load({id:t.getId(),name:"com.rds.rap.yrdsrap0020.view.VH.DescriptionVH",controller:i}).then(function(e){t.addDependent(e);e.setRangeKeyFields([{+
label:this.getView().getModel("i18n").getProperty("fdDescription"),key:"StatusDesc",type:"string"}]);e.open()}.bind(this))},onDescriptionVHOK:function(e){var t=e.getParameter("tokens");var s=this.byId("MIVHRejRsnDes");s.removeAllTokens();while(t.length>1+
){t=[t.pop()]}s.setTokens(t);this.byId("dialogDescription").close()},onDescriptionVHCanc:function(){this.byId("dialogDescription").close()},onDescriptionVHClose:function(){this.byId("dialogDescription").destroy()},onReprice:function(){var e=this.getView(+
);e.getModel("selected").setProperty("/bBusy",true);var t=this.getView().byId("repriceDP").getValue();var s=this.getView().getModel();var i=this.getView().getModel("repriceMessage");var a=this.byId("tbMain").getSelectedItems().map(function(e){return{Sale+
sOrder:e.getBindingContext().getProperty("SalesOrder"),RepriceDate:t}});var r=_.map(a,_.property("SalesOrder"));var n=[];if(t!==""){s.setDeferredGroups(s.getDeferredGroups().concat(["repriceFunction"]));a.forEach(function(e,t){s.callFunction("/Reprice",{+
method:"POST",urlParameters:e,groupId:"repriceFunction",changeSetId:t})},this);s.submitChanges({groupId:"repriceFunction",success:function(t){this.getView().byId("dialogReprice").close();s.refresh();n=this.resultMessageForm(t,r,i);this.openRepriceResultD+
ialog(n,e)}.bind(this),error:function(t){this.getView().byId("dialogReprice").close();n=this.resultMessageForm(t,r,i);this.openRepriceResultDialog(n,e)}.bind(this)})}else{n=this.orderDateEmptyMessage(r);this.openRepriceResultDialog(n,e)}this.getView().ge+
tModel("selected").setProperty("/bBusy",false)},onCloseRep:function(){this.getView().byId("repriceDP").setValue(null);this.getView().byId("dialogReprice").close()},onCloseRej:function(){this.getView().byId("dialogRejectAll").close()},onCloseRepRes:functi+
on(){this.getView().byId("dialogRepriceResult").close()},onCloseRejRes:function(){this.getView().byId("dialogRejectResult").close()},onVHCancRejRsn:function(){this.getView().byId("vhDialogRejectReason").close()},pressLinkExternal:function(e){var t=e.getS+
ource().getBindingContext().getObject();var s=this.getCustomData(e.getSource(),"Semantic");var i=this.getCustomData(e.getSource(),"Action");var a={semanticObject:s,action:i};var r=this._getExternalParameter(a,t);this.onListNavigationExtension(a,r);return+
 true},fcNavDetail:function(e){var t=e.getParameter("listItem").getBindingContext().getObject().SalesOrder;this.getOwnerComponent().getRouter().navTo("Detail",{SalesOrder:t})},onListNavigationExtension:function(e,t){sap.ushell.Container.getService("Cross+
ApplicationNavigation").toExternal({target:{semanticObject:e.semanticObject,action:e.action},params:t})},getCustomData:function(e,t){var s=e?e.getCustomData():[];var i=_.find(s,function(e){return e.getProperty("key")===t});return i&&i.getProperty("value"+
)},_getExternalParameter:function(e,t){var s={};if(e.semanticObject==="SalesOrder"){s={SalesOrder:t.SalesOrder}}else if(e.semanticObject==="SPOC09"){if(e.action==="F0850A"){s={SoldToParty:t.SoldToParty}}else if(e.action==="F4596"){s={SoldToParty:t.SoldTo+
Party}}}return s},resultMessageForm:function(e,t,s){var i=[];var a=this;var n=e.__batchResponses;n.forEach(function(e,a){var n=JSON.parse(e.__changeResponses[0].headers["sap-message"]);if(n.details.length>0){n=n.details[0]}var o=this.checkMessageType(n.s+
everity);i=_.concat(i,[n].map(function(e){return new r({message:e.message,type:o,description:t[a],processor:s})}))},this);return i},openRejectResultDialog:function(e,t){this.rejectMessageManager.removeAllMessages();this.rejectMessageManager.addMessages(e+
);var i=n.Success;if(_.find(e,{type:n.Warning})){i=n.Warning}if(_.find(e,{type:n.Error})){i=n.Error}this.getView().getModel("selected").setProperty("/sState",i);if(!this.getView().byId("dialogRejectResult")){s.load({id:t.getId(),name:"com.rds.rap.yrdsrap+
0020.view.popup.RejectResult",controller:this}).then(function(e){t.addDependent(e);e.open()}.bind(this))}else{this.getView().byId("dialogRejectResult").open()}},rejectReasonEmptyMessage:function(e){var t=[];e.forEach(function(e){t=_.concat(t,[new r({mess+
age:this.getView().getModel("i18n").getProperty("erEmptyReason"),type:n.Error,description:e})])},this);return t},openRepriceResultDialog:function(e,t){this.repriceMessageManager.removeAllMessages();this.repriceMessageManager.addMessages(e);var i=n.Succes+
s;if(_.find(e,{type:n.Warning})){i=n.Warning}if(_.find(e,{type:n.Error})){i=n.Error}this.getView().getModel("selected").setProperty("/sState",i);if(!this.getView().byId("dialogRepriceResult")){s.load({id:t.getId(),name:"com.rds.rap.yrdsrap0020.view.popup+
.RepriceResult",controller:this}).then(function(e){t.addDependent(e);e.open()}.bind(this))}else{this.getView().byId("dialogRepriceResult").open()}},orderDateEmptyMessage:function(e){var t=[];e.forEach(function(e){t=_.concat(t,[new r({message:this.getView+
().getModel("i18n").getProperty("erEmptyDate"),type:n.Error,description:e})])},this);return t},checkMessageType:function(e){var t=_.capitalize(e);var s=n.None;if(t==="Success"){s=n.Success}else if(t==="Error"){s=n.Error}else if(t==="Warning"){s=n.Warning+
}return s},initMIReject:function(){var e=this.byId("MIVHRejRsn");var t=this.byId("MIVHRejRsnDes");var s=function(e){var t=e.text;return new o({key:"="+t,text:"="+t})};e.addValidator(s);t.addValidator(s)},valuHelpCustomFilter_rejectAll:function(e){var t=t+
his.getView().byId("fbRejectReason");var s=this._valueHelpSupportRangeFilter(t);this._filterValueHelpTable_rejectAll(s)},_filterValueHelpTable_rejectAll:function(e){this.byId("vhDialogRejectReason").getTableAsync().then(function(t){if(t.bindRows){t.getBi+
nding("rows").filter(e)}if(t.bindItems){t.getBinding("items").filter(e)}this.byId("vhDialogRejectReason").update()}.bind(this))},_valueHelpSupportRangeFilter:function(e){var t=e.getBasicSearchValue();var s=[];var i=[];e.getAllFilterItems().forEach(functi+
on(e){var a=e.getControl();switch(a.getMetadata().getName()){case"sap.m.Input":if(a.getValue()){i.push(new d({path:a.getName(),operator:g.Contains,value1:a.getValue().replace(/(^[0]*)/gi,"")}))}if(t){s.push(new d({path:a.getName(),operator:g.Contains,val+
ue1:t}))}break;case"sap.m.MultiInput":var r=/\*([- ,가-힣`~!@#$%^&*|\\\'\";:\/?0-9a-zA-Z]+)\*/;var n=/<=([- ,가-힣`~!@#$%^&*|\\\'\";:\/?0-9a-zA-Z]+)/;var o=/>=([- ,가-힣`~!@#$%^&*|\\\'\";:\/?0-9a-zA-Z]+)/;var l=/!\(=([- ,가-힣`~!@#$%^&*|\\\'\";:\/?0-9a-zA-Z]*)\)+
/;var c=/=([- ,가-힣`~!@#$%^&*|\\\'\";:\/?0-9a-zA-Z]*)/;var p=/([- ,가-힣`~!@#$%^&*|\\\'\";:\/?0-9a-zA-Z]+)\*/;var u=/\*([- ,가-힣`~!@#$%^&*|\\\'\";:\/?0-9a-zA-Z]+)/;var h=/([- ,가-힣`~!@#$%^&*|\\\'\";:\/?0-9a-zA-Z]+)\.\.\.([- ,가-힣`~!@#$%^&*|\\\'\";:\/?0-9a-zA-Z+
]+)/;var f=/<([- ,가-힣`~!@#$%^&*|\\\'\";:\/?0-9a-zA-Z]+)/;var m=/>([- ,가-힣`~!@#$%^&*|\\\'\";:\/?0-9a-zA-Z]+)/;_.forEach(a.getTokens(),function(e){var t=e.getText();var s="";var R="";var v="";if(t==="<empty>"){s=g.EQ;R=""}else if(t==="!(<empty>)"){s=g.NE;R+
=""}else if(t.match(r)){s=g.Contains;R=t.match(r)[1]}else if(t.match(n)){s=g.LE;R=t.match(n)[1]}else if(t.match(o)){s=g.GE;R=t.match(o)[1]}else if(t.match(l)){s=g.NE;R=t.match(l)[1]}else if(t.match(c)){s=g.EQ;R=t.match(c)[1]}else if(t.match(p)){s=g.Start+
sWith;R=t.match(p)[1]}else if(t.match(u)){s=g.EndsWith;R=t.match(u)[1]}else if(t.match(h)){s=g.BT;R=t.match(h)[1];v=t.match(h)[2]}else if(t.match(f)){s=g.LT;R=t.match(f)[1]}else if(t.match(m)){s=g.GT;R=t.match(m)[1]}else{s=g.Contains;R=t}var y=new d({pat+
h:a.getName(),operator:s,value1:R,value2:v});i.push(y)});if(t){s.push(new d({path:a.getName(),operator:g.Contains,value1:t}))}break;case"sap.m.MultiComboBox":var R=a.getSelectedKeys();var v=[];if(R.length>0){_.forEach(R,function(e){v.push(new d({path:a.g+
etName(),operator:g.EQ,value1:e}))});i.push(new d({filters:v,bAnd:false}))}break}}.bind(this),[]);var a=[];if(s.length>0&&i.length>0){a=new d({filters:[new d({filters:s,bAnd:false}),new d({filters:i,bAnd:true})],bAnd:true})}else if(s.length>0){a=new d({f+
ilters:s,bAnd:false})}else if(i.length>0){a=new d({filters:i,bAnd:true})}else{a=null}return a}})});                                                                                                                                                            